<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin - CRUD de Competências e Conquistas</title>
    <link rel="stylesheet" href="styles/desktop.css" />
    <link rel="stylesheet" href="styles/mobile.css" />
    <link rel="stylesheet" href="styles/tree.css" />
    <link rel="stylesheet" href="styles/admin.css" />
    <!-- Bootstrap -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr"
      crossorigin="anonymous">
    <!-- Bootstrap Icons -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css"
      rel="stylesheet" />
    <style>
      .sidebar {
        transition: box-shadow 0.2s;
        background: #fff;
      }
      .sidebar .nav-link {
        color: #333;
        border-radius: 0.375rem;
        font-weight: 500;
        transition: background 0.15s, color 0.15s;
      }
      .sidebar .nav-link.active, .sidebar .nav-link:hover {
        background: #0d6efd;
        color: #fff;
      }
      .sidebar .nav-link i {
        font-size: 1.2rem;
      }
      .achievement-img {
        border-radius: 50% !important; /* Imagens redondas */
      }
      @media (max-width: 991px) {
        .sidebar { width: 100vw; min-height: auto; position: static; }
        .admin-layout { flex-direction: column !important; }
      }
    </style>
  </head>
  <body>
    <div class="admin-layout d-flex">
      <!-- Sidebar moderno -->
      <nav id="admin-sidebar"
        class="sidebar bg-white border-end shadow-sm d-flex flex-column flex-shrink-0 p-3"
        style="width: 250px; min-height: 100vh; position:sticky; top:0; z-index: 1020;">
        <a href="#"
          class="d-flex align-items-center mb-3 mb-md-0 me-md-auto text-decoration-none">
          <i class="bi bi-award fs-3 text-primary me-2"></i>
          <span class="fs-4 fw-bold">Admin</span>
        </a>
        <hr>
        <ul class="nav nav-pills flex-column mb-auto gap-2">
          <li class="nav-item">
            <a href="#" id="sidebar-skills"
              class="nav-link active d-flex align-items-center"
              onclick="showCrudSection('skills')">
              <i class="bi bi-lightbulb me-2"></i> Habilidades
            </a>
          </li>
          <li>
            <a href="#" id="sidebar-achievements"
              class="nav-link d-flex align-items-center"
              onclick="showCrudSection('achievements')">
              <i class="bi bi-trophy me-2"></i> Conquistas
            </a>
          </li>
        </ul>
        <hr>
        <div class="text-muted small mt-auto">&copy; 2025 Competence Admin</div>
      </nav>
      <div class="flex-grow-1">
        <!-- Modal de Conquista -->
        <div class="modal fade" id="achievementModal" tabindex="-1"
          aria-labelledby="achievementModalLabel" aria-hidden="true">
          <div class="modal-dialog modal-lg">
            <div class="modal-content">
              <form id="achievement-modal-form">
                <input type="hidden" id="modal-achievement-id" />
                <div class="modal-header">
                  <h5 class="modal-title" id="achievementModalLabel">Nova
                    Conquista</h5>
                  <button type="button" class="btn-close"
                    data-bs-dismiss="modal" aria-label="Fechar"></button>
                </div>
                <div class="modal-body">
                  <div class="row g-3">
                    <div class="col-md-6">
                      <label for="modal-achievement-title"
                        class="form-label">Título</label>
                      <input type="text" class="form-control"
                        id="modal-achievement-title" required />
                    </div>
                    <div class="col-md-6">
                      <label for="modal-achievement-category"
                        class="form-label">Categoria</label>
                      <div class="input-group">
                        <select class="form-select"
                          id="modal-achievement-category">
                          <option value="QA">QA</option>
                          <option value="DEV">DEV</option>
                          <option value="SOFT">SOFT</option>
                          <option value="GESTAO">GESTÃO</option>
                        </select>
                        <div class="input-group-text">
                          <input type="checkbox"
                            id="modal-achievement-category-new-check"
                            title="Nova categoria" />
                        </div>
                      </div>
                      <input type="text" class="form-control mt-2 d-none"
                        id="modal-achievement-category-new"
                        placeholder="Digite nova categoria" />
                    </div>
                    <div class="col-md-12">
                      <label for="modal-achievement-desc"
                        class="form-label">Descrição</label>
                      <textarea class="form-control" id="modal-achievement-desc"
                        rows="2"></textarea>
                    </div>
                    <div class="col-md-4">
                      <label class="form-label">Status</label>
                      <div class="form-check form-switch mt-2">
                        <input class="form-check-input" type="checkbox"
                          id="modal-achievement-status-switch" checked>
                        <label class="form-check-label"
                          for="modal-achievement-status-switch">Desbloqueada</label>
                      </div>
                      <input type="hidden" id="modal-achievement-status"
                        value="unlocked" />
                    </div>
                    <div class="col-md-4">
                      <label class="form-label">Dificuldade</label>
                      <div id="modal-achievement-difficulty-stars"
                        class="star-rating" data-score="3">
                        <i class="bi bi-star-fill"></i>
                        <i class="bi bi-star-fill"></i>
                        <i class="bi bi-star-fill"></i>
                        <i class="bi bi-star"></i>
                        <i class="bi bi-star"></i>
                      </div>
                      <input type="hidden" id="modal-achievement-difficulty"
                        value="3" />
                    </div>
                    <div class="col-md-4">
                      <label for="modal-achievement-unlockedDate"
                        class="form-label">Data</label>
                      <input type="date" class="form-control"
                        id="modal-achievement-unlockedDate" />
                    </div>
                    <div class="col-md-6">
                      <label for="modal-achievement-evidence"
                        class="form-label">Evidência (URL)</label>
                      <input type="text" class="form-control"
                        id="modal-achievement-evidence"
                        placeholder="https://..." />
                    </div>
                    <div class="col-md-6">
                      <label for="modal-achievement-relatedSkills"
                        class="form-label">Skills Relacionadas</label>
                      <select class="form-select"
                        id="modal-achievement-relatedSkills" multiple size="6"
                        aria-describedby="modal-achievement-relatedSkills-help"></select>
                      <small id="modal-achievement-relatedSkills-help"
                        class="form-text text-muted">Segure Ctrl (Windows) ou
                        Cmd (Mac) para selecionar múltiplas skills.</small>
                    </div>
                    <div class="col-md-12">
                      <label for="modal-achievement-img-url"
                        class="form-label">Imagem (URL)</label>
                      <div class="input-group mb-2">
                        <input type="file" class="form-control"
                          id="modal-achievement-img" accept="image/*"
                          style="max-width: 60%" />
                      </div>
                      <div class="input-group mb-2">
                        <input type="text" class="form-control"
                          id="modal-achievement-img-url"
                          placeholder="https://..." />
                      </div>
                      <div class="mb-2">
                        <img id="modal-achievement-img-preview" src
                          alt="Preview" class="achievement-img"
                          style="max-width: 100px; max-height: 100px; border:1px solid #ccc; display: none;" />
                      </div>
                    </div>
                  </div>
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-secondary"
                    data-bs-dismiss="modal">Cancelar</button>
                  <button type="submit" class="btn btn-primary">Salvar</button>
                </div>
              </form>
            </div>
          </div>
        </div>
        <!-- Modal de Habilidade -->
        <div class="modal fade" id="skillModal" tabindex="-1"
          aria-labelledby="skillModalLabel" aria-hidden="true">
          <div class="modal-dialog modal-lg">
            <div class="modal-content">
              <form id="skill-modal-form">
                <input type="hidden" id="modal-skill-id" />
                <input type="hidden" id="modal-skill-unlock-threshold"
                  value="0" />
                <div class="modal-header">
                  <h5 class="modal-title" id="skillModalLabel">Nova
                    Habilidade</h5>
                  <button type="button" class="btn-close"
                    data-bs-dismiss="modal" aria-label="Fechar"></button>
                </div>
                <div class="modal-body">
                  <div class="row g-3">
                    <div class="col-md-6">
                      <label for="modal-skill-name"
                        class="form-label">Nome</label>
                      <input type="text" class="form-control"
                        id="modal-skill-name" required />
                    </div>
                    <div class="col-md-3">
                      <label for="modal-skill-category"
                        class="form-label">Categoria</label>
                      <div class="input-group">
                        <select class="form-select" id="modal-skill-category">
                          <option value="QA">QA</option>
                          <option value="DEV">DEV</option>
                          <option value="SOFT">SOFT</option>
                          <option value="GESTAO">GESTÃO</option>
                        </select>
                        <div class="input-group-text">
                          <input type="checkbox"
                            id="modal-skill-category-new-check"
                            title="Nova categoria" />
                        </div>
                      </div>
                      <input type="text" class="form-control mt-2 d-none"
                        id="modal-skill-category-new"
                        placeholder="Digite nova categoria" />
                    </div>
                    <div class="col-md-3">
                      <label class="form-label">Domínio <span
                          id="modal-domain-value">3/25 (12%)</span></label>
                      <input type="text" class="form-control-plaintext"
                        id="modal-skill-domain" value="3/25 (12%)" readonly
                        tabindex="-1"
                        style="pointer-events:none;user-select:all;" />
                    </div>
                    <div class="col-md-6">
                      <label for="modal-skill-icon" class="form-label">Ícone
                        (Bootstrap Icon)</label>
                      <input type="text" class="form-control"
                        id="modal-skill-icon" placeholder="bi-lightbulb" />
                    </div>
                    <div class="col-md-6">
                      <label for="modal-skill-desc"
                        class="form-label">Descrição</label>
                      <textarea class="form-control" id="modal-skill-desc"
                        rows="2"></textarea>
                    </div>
                    <div class="col-md-6">
                      <label for="modal-skill-parent"
                        class="form-label">Habilidade Pai (opcional)</label>
                      <select class="form-select" id="modal-skill-parent">
                        <option value>Nenhuma</option>
                      </select>
                    </div>
                    <div class="col-md-6">
                      <label class="form-label">Filhos</label>
                      <select class="form-select" id="modal-skill-children"
                        multiple size="6"
                        aria-describedby="modal-skill-children-help"></select>
                      <small id="modal-skill-children-help"
                        class="form-text text-muted">Segure Ctrl (Windows) ou
                        Cmd (Mac) para selecionar múltiplos filhos.</small>
                    </div>
                    <div class="col-md-12">
                      <label for="modal-skill-relatedAchievements"
                        class="form-label">Conquistas Relacionadas</label>
                      <select class="form-select"
                        id="modal-skill-relatedAchievements" multiple size="6"
                        aria-describedby="modal-skill-relatedAchievements-help"></select>
                      <small id="modal-skill-relatedAchievements-help"
                        class="form-text text-muted">Segure Ctrl (Windows) ou
                        Cmd (Mac) para selecionar múltiplas conquistas.</small>
                    </div>
                    <div class="col-md-12">
                      <label class="form-label">Pontuações</label>
                      <div class="row g-2">
                        <div class="col">
                          <label class="form-label">Teórico</label>
                          <div class="star-rating"
                            id="modal-score-theoretical-stars" data-score="3">
                            <i class="bi bi-star-fill"></i><i
                              class="bi bi-star-fill"></i><i
                              class="bi bi-star-fill"></i><i
                              class="bi bi-star"></i><i class="bi bi-star"></i>
                          </div>
                          <input type="hidden" id="modal-score-theoretical"
                            value="3" />
                        </div>
                        <div class="col">
                          <label class="form-label">Técnico</label>
                          <div class="star-rating"
                            id="modal-score-technical-stars" data-score="3">
                            <i class="bi bi-star-fill"></i><i
                              class="bi bi-star-fill"></i><i
                              class="bi bi-star-fill"></i><i
                              class="bi bi-star"></i><i class="bi bi-star"></i>
                          </div>
                          <input type="hidden" id="modal-score-technical"
                            value="3" />
                        </div>
                        <div class="col">
                          <label class="form-label">Problemas</label>
                          <div class="star-rating"
                            id="modal-score-problem-solving-stars"
                            data-score="3">
                            <i class="bi bi-star-fill"></i><i
                              class="bi bi-star-fill"></i><i
                              class="bi bi-star-fill"></i><i
                              class="bi bi-star"></i><i class="bi bi-star"></i>
                          </div>
                          <input type="hidden" id="modal-score-problem-solving"
                            value="3" />
                        </div>
                        <div class="col">
                          <label class="form-label">Transferência</label>
                          <div class="star-rating"
                            id="modal-score-knowledge-transfer-stars"
                            data-score="3">
                            <i class="bi bi-star-fill"></i><i
                              class="bi bi-star-fill"></i><i
                              class="bi bi-star-fill"></i><i
                              class="bi bi-star"></i><i class="bi bi-star"></i>
                          </div>
                          <input type="hidden"
                            id="modal-score-knowledge-transfer" value="3" />
                        </div>
                        <div class="col">
                          <label class="form-label">Tendências</label>
                          <div class="star-rating" id="modal-score-trends-stars"
                            data-score="3">
                            <i class="bi bi-star-fill"></i><i
                              class="bi bi-star-fill"></i><i
                              class="bi bi-star-fill"></i><i
                              class="bi bi-star"></i><i class="bi bi-star"></i>
                          </div>
                          <input type="hidden" id="modal-score-trends"
                            value="3" />
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-secondary"
                    data-bs-dismiss="modal">Cancelar</button>
                  <button type="submit" class="btn btn-primary">Salvar</button>
                </div>
              </form>
            </div>
          </div>
        </div>
        <!-- Toast para feedback -->
        <div class="toast-container position-fixed bottom-0 end-0 p-3">
          <div id="adminToast" class="toast" role="alert" aria-live="assertive"
            aria-atomic="true">
            <div class="toast-header">
              <strong class="me-auto">Notificação</strong>
              <button type="button" class="btn-close" data-bs-dismiss="toast"
                aria-label="Fechar"></button>
            </div>
            <div class="toast-body" id="adminToastMsg"></div>
          </div>
        </div>

        <main class="admin-main container-xl py-4"
          style="max-width: 1100px; margin: 0 auto;">
          <header class="admin-header mb-4">
            <h1 class="fw-bold" style="font-size:2.2rem;">Painel Admin -
              CRUD</h1>
          </header>
          <section class="crud-section active" id="skills-section">
            <div
              class="section-header d-flex justify-content-between align-items-center">
              <h2><i class="bi bi-lightbulb"></i> Habilidades</h2>
              <button class="btn btn-success" id="btnAddSkillModal"
                type="button"><i class="bi bi-plus-circle"></i> Nova
                Habilidade</button>
            </div>
            <div id="skills-list" class="card-list w-100"></div>
          </section>
          <section class="crud-section" id="achievements-section">
            <div
              class="section-header d-flex justify-content-between align-items-center">
              <h2><i class="bi bi-trophy"></i> Conquistas</h2>
              <button class="btn btn-success" id="btnAddAchievementModal"
                type="button"><i class="bi bi-plus-circle"></i> Nova
                Conquista</button>
            </div>
            <div id="achievements-list" class="card-list w-100"></div>
          </section>
        </main>
      </div>
    </div>

    <script>
      // Função auxiliar para persistência de dados
      window.postJsonApi = async function(endpoint, data) {
        try {
          const response = await fetch(`data/${endpoint}.json`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
          });
          if (!response.ok) throw new Error('Erro ao salvar dados');
          return await response.json();
        } catch (e) {
          console.error(`Erro ao salvar ${endpoint}:`, e);
          throw e;
        }
      };

      // Listagem de habilidades em cards horizontais col-12
      async function renderSkillsList() {
        const list = document.getElementById('skills-list');
        list.innerHTML = '<div class="text-center py-4">Carregando...</div>';
        try {
          const res = await fetch('data/skills.json');
          const data = await res.json();
          window.skillsData = data;
          if (!data.skills || data.skills.length === 0) {
            list.innerHTML = '<div class="alert alert-info">Nenhuma habilidade encontrada.</div>';
            return;
          }
          list.innerHTML = '';
          data.skills.forEach(skill => {
            // Oculta habilidades inativas
            if (skill.ativo === false) return;
            const scores = skill.scores || {};
            const related = (skill.children && skill.children.length) ? skill.children.join(', ') : '-';
            const card = document.createElement('div');
            card.className = 'card mb-3 col-12 shadow-sm';
            card.innerHTML = `
              <div class="card-body d-flex flex-wrap align-items-center justify-content-between gap-3">
                <div class="d-flex align-items-center gap-3 flex-wrap">
                  <i class="bi ${(skill.icon || 'bi-lightbulb')} fs-2 text-primary"></i>
                  <div>
                    <h5 class="mb-1">${skill.title || ''} <small class="text-muted">#${skill.id || ''}</small></h5>
                    <div class="mb-1"><span class="badge bg-secondary">${skill.category || ''}</span> <span class="badge bg-info">${skill.domain || 0}</span> <span class="badge bg-light text-dark">${skill.parent ? 'Filho' : 'Raiz'}</span></div>
                    <div class="mb-1">${skill.description || ''}</div>
                    <div class="mb-1">
                      <span class="badge bg-warning text-dark">Teórico: ${scores.theoretical ?? '-'}</span>
                      <span class="badge bg-warning text-dark">Técnico: ${scores.technical ?? '-'}</span>
                      <span class="badge bg-warning text-dark">Problemas: ${scores.problem_solving ?? '-'}</span>
                      <span class="badge bg-warning text-dark">Transferência: ${scores.knowledge_transfer ?? '-'}</span>
                      <span class="badge bg-warning text-dark">Tendências: ${scores.trends ?? '-'}</span>
                    </div>
                    <div class="mb-1"><small class="text-muted">Filhos: ${related}</small></div>
                  </div>
                </div>
                <div class="d-flex flex-column gap-2 align-items-end">
                  <div class="form-check form-switch">
                    <input class="form-check-input" type="checkbox" id="active-skill-${skill.id}" ${skill.ativo !== false ? 'checked' : ''}>
                    <label class="form-check-label" for="active-skill-${skill.id}">Ativo</label>
                  </div>
                  <div class="btn-group">
                    <button class="btn btn-outline-primary btn-sm btn-edit-skill" data-id="${skill.id}" title="Editar"><i class="bi bi-pencil"></i></button>
                    <button class="btn btn-outline-danger btn-sm btn-delete-skill" data-id="${skill.id}" title="Excluir"><i class="bi bi-trash"></i></button>
                  </div>
                </div>
              </div>
            `;
            list.appendChild(card);
            // Evento para persistir o switch "Ativo"
            setTimeout(() => {
              const switchEl = document.getElementById(`active-skill-${skill.id}`);
              if (switchEl) {
                switchEl.checked = skill.ativo !== false;
                switchEl.addEventListener('change', async function() {
                  skill.ativo = switchEl.checked;
                  const idx = window.skillsData.skills.findIndex(s => s.id == skill.id);
                  if (idx !== -1) {
                    window.skillsData.skills[idx].ativo = skill.ativo;
                    try {
                      await window.postJsonApi('skills', window.skillsData);
                      renderSkillsList();
                      const toastMsg = document.getElementById('adminToastMsg');
                      if (toastMsg) toastMsg.textContent = 'Estado da habilidade atualizado!';
                      const toast = document.getElementById('adminToast');
                      if (toast && window.bootstrap) new bootstrap.Toast(toast).show();
                    } catch (e) {
                      console.error('Erro ao atualizar habilidade:', e);
                    }
                  }
                });
              }
            }, 0);
          });
          // Adicionar eventos aos botões de editar/excluir
          list.querySelectorAll('.btn-edit-skill').forEach(btn => {
            btn.addEventListener('click', function() {
              const skillId = btn.getAttribute('data-id');
              const skill = data.skills.find(s => s.id == skillId);
              if (skill && window.showSkillModal) window.showSkillModal(skill);
            });
          });
          list.querySelectorAll('.btn-delete-skill').forEach(btn => {
            btn.addEventListener('click', async function() {
              const skillId = btn.getAttribute('data-id');
              const skill = data.skills.find(s => s.id == skillId);
              if (!skill) return;
              if (confirm(`Tem certeza que deseja excluir a habilidade "${skill.title}"?`)) {
                window.skillsData.skills = window.skillsData.skills.filter(s => s.id != skillId);
                try {
                  await window.postJsonApi('skills', window.skillsData);
                  renderSkillsList();
                  const toastMsg = document.getElementById('adminToastMsg');
                  if (toastMsg) toastMsg.textContent = 'Habilidade excluída com sucesso!';
                  const toast = document.getElementById('adminToast');
                  if (toast && window.bootstrap) new bootstrap.Toast(toast).show();
                } catch (e) {
                  console.error('Erro ao excluir habilidade:', e);
                }
              }
            });
          });
        } catch (e) {
          list.innerHTML = '<div class="alert alert-danger">Erro ao carregar habilidades.</div>';
        }
      }

      // Listagem de conquistas em cards horizontais col-12
      async function renderAchievementsList() {
        const list = document.getElementById('achievements-list');
        list.innerHTML = '<div class="text-center py-4">Carregando...</div>';
        try {
          const res = await fetch('data/achievements.json');
          const data = await res.json();
          window.achievements = data;
          if (!Array.isArray(data) || data.length === 0) {
            list.innerHTML = '<div class="alert alert-info">Nenhuma conquista encontrada.</div>';
            return;
          }
          list.innerHTML = '';
          data.forEach(ach => {
            // Oculta conquistas inativas
            if (ach.status === 'locked') return;
            const img = ach.image || ach.img || '';
            const evidence = ach.evidence ? `<a href="${ach.evidence}" target="_blank" class="badge bg-success">Evidência</a>` : '';
            const card = document.createElement('div');
            card.className = 'card mb-3 col-12 shadow-sm';
            card.innerHTML = `
              <div class="card-body d-flex flex-wrap align-items-center justify-content-between gap-3">
                <div class="d-flex align-items-center gap-3 flex-wrap">
                  <div style="width:64px;height:64px;overflow:hidden;border-radius:50%;background:#f8f9fa;display:flex;align-items:center;justify-content:center;">
                    ${img ? `<img src="${img}" alt="img" class="achievement-img" style="max-width:100%;max-height:100%;object-fit:cover;">` : '<i class="bi bi-image fs-1 text-secondary"></i>'}
                  </div>
                  <div>
                    <h5 class="mb-1">${ach.title || ''} <small class="text-muted">#${ach.id || ''}</small></h5>
                    <div class="mb-1"><span class="badge bg-secondary">${ach.category || ''}</span> <span class="badge bg-light text-dark">${ach.status || ''}</span> <span class="badge bg-info">Dificuldade: ${ach.difficulty || '-'}</span></div>
                    <div class="mb-1">${ach.description || ''}</div>
                    <div class="mb-1"><small class="text-muted">Data: ${ach.unlockedDate || '-'}</small> ${evidence}</div>
                  </div>
                </div>
                <div class="d-flex flex-column gap-2 align-items-end">
                  <div class="form-check form-switch">
                    <input class="form-check-input" type="checkbox" id="active-achievement-${ach.id}" ${ach.status !== 'locked' ? 'checked' : ''}>
                    <label class="form-check-label" for="active-achievement-${ach.id}">Ativo</label>
                  </div>
                  <div class="btn-group">
                    <button class="btn btn-outline-primary btn-sm btn-edit-achievement" data-id="${ach.id}" title="Editar"><i class="bi bi-pencil"></i></button>
                    <button class="btn btn-outline-danger btn-sm btn-delete-achievement" data-id="${ach.id}" title="Excluir"><i class="bi bi-trash"></i></button>
                  </div>
                </div>
              </div>
            `;
            list.appendChild(card);
            // Evento para persistir o switch "Ativo"
            setTimeout(() => {
              const switchEl = document.getElementById(`active-achievement-${ach.id}`);
              if (switchEl) {
                switchEl.checked = ach.status !== 'locked';
                switchEl.addEventListener('change', async function() {
                  ach.status = switchEl.checked ? 'unlocked' : 'locked';
                  const idx = window.achievements.findIndex(a => a.id == ach.id);
                  if (idx !== -1) {
                    window.achievements[idx].status = ach.status;
                    try {
                      await window.postJsonApi('achievements', window.achievements);
                      renderAchievementsList();
                      const toastMsg = document.getElementById('adminToastMsg');
                      if (toastMsg) toastMsg.textContent = 'Estado da conquista atualizado!';
                      const toast = document.getElementById('adminToast');
                      if (toast && window.bootstrap) new bootstrap.Toast(toast).show();
                    } catch (e) {
                      console.error('Erro ao atualizar conquista:', e);
                    }
                  }
                });
              }
            }, 0);
          });
          // Adicionar eventos aos botões de editar/excluir
          list.querySelectorAll('.btn-edit-achievement').forEach(btn => {
            btn.addEventListener('click', function() {
              const achId = btn.getAttribute('data-id');
              const ach = data.find(a => a.id == achId);
              if (ach && window.showAchievementModal) window.showAchievementModal(ach);
            });
          });
          list.querySelectorAll('.btn-delete-achievement').forEach(btn => {
            btn.addEventListener('click', async function() {
              const achId = btn.getAttribute('data-id');
              const ach = data.find(a => a.id == achId);
              if (!ach) return;
              if (confirm(`Tem certeza que deseja excluir a conquista "${ach.title}"?`)) {
                window.achievements = window.achievements.filter(a => a.id != achId);
                try {
                  await window.postJsonApi('achievements', window.achievements);
                  renderAchievementsList();
                  const toastMsg = document.getElementById('adminToastMsg');
                  if (toastMsg) toastMsg.textContent = 'Conquista excluída com sucesso!';
                  const toast = document.getElementById('adminToast');
                  if (toast && window.bootstrap) new bootstrap.Toast(toast).show();
                } catch (e) {
                  console.error('Erro ao excluir conquista:', e);
                }
              }
            });
          });
        } catch (e) {
          list.innerHTML = '<div class="alert alert-danger">Erro ao carregar conquistas.</div>';
        }
      }

      // Preencher dropdown de skills relacionadas no modal de conquistas
      document.addEventListener('DOMContentLoaded', function() {
        function fillRelatedSkillsDropdown(selected = []) {
          var select = document.getElementById('modal-achievement-relatedSkills');
          if (!select) return;
          select.innerHTML = '';
          if (window.skillsData && Array.isArray(window.skillsData.skills)) {
            window.skillsData.skills.forEach(skill => {
              var opt = document.createElement('option');
              opt.value = skill.id;
              opt.textContent = skill.title + (skill.id ? ` (${skill.id})` : '');
              if (selected.includes(skill.id)) opt.selected = true;
              select.appendChild(opt);
            });
          }
        }
        window.showAchievementModal = (function(origFn) {
          return function(achievement) {
            fillRelatedSkillsDropdown(achievement && achievement.relatedSkills ? achievement.relatedSkills : []);
            origFn && origFn(achievement);
          }
        })(window.showAchievementModal);
      });

      // Switch visual para status no modal de conquistas
      document.addEventListener('DOMContentLoaded', function() {
        var statusSwitch = document.getElementById('modal-achievement-status-switch');
        var statusInput = document.getElementById('modal-achievement-status');
        var statusLabel = document.querySelector('label[for="modal-achievement-status-switch"]');
        if (statusSwitch && statusInput && statusLabel) {
          statusSwitch.addEventListener('change', function() {
            if (statusSwitch.checked) {
              statusInput.value = 'unlocked';
              statusLabel.textContent = 'Desbloqueada';
            } else {
              statusInput.value = 'locked';
              statusLabel.textContent = 'Bloqueada';
            }
          });
        }
      });

      // Estrelas interativas para dificuldade no modal de conquistas
      document.addEventListener('DOMContentLoaded', function() {
        var starDiv = document.getElementById('modal-achievement-difficulty-stars');
        var input = document.getElementById('modal-achievement-difficulty');
        if (starDiv && input) {
          const stars = starDiv.querySelectorAll('i');
          stars.forEach((star, idx) => {
            star.addEventListener('click', function() {
              stars.forEach((s, i) => {
                s.className = i <= idx ? 'bi bi-star-fill' : 'bi bi-star';
              });
              starDiv.dataset.score = idx + 1;
              input.value = idx + 1;
            });
          });
        }
      });

      // Pré-visualização de imagens no modal de conquistas
      document.addEventListener('DOMContentLoaded', function() {
        const imgInput = document.getElementById('modal-achievement-img');
        const imgUrlInput = document.getElementById('modal-achievement-img-url');
        const imgPreview = document.getElementById('modal-achievement-img-preview');
        if (imgInput && imgPreview) {
          imgInput.addEventListener('change', function(event) {
            const file = event.target.files[0];
            if (file) {
              const reader = new FileReader();
              reader.onload = function(e) {
                imgPreview.src = e.target.result;
                imgPreview.style.display = 'block';
                imgUrlInput.value = '';
              };
              reader.readAsDataURL(file);
            }
          });
        }
        if (imgUrlInput && imgPreview) {
          imgUrlInput.addEventListener('input', function() {
            imgPreview.src = imgUrlInput.value;
            imgPreview.style.display = imgUrlInput.value ? 'block' : 'none';
            imgInput.value = '';
          });
        }
      });

      // Dropdown dinâmico para categoria de conquista
      document.addEventListener('DOMContentLoaded', function() {
        var catCheck = document.getElementById('modal-achievement-category-new-check');
        var catSelect = document.getElementById('modal-achievement-category');
        var catInput = document.getElementById('modal-achievement-category-new');
        if (catCheck && catSelect && catInput) {
          catCheck.addEventListener('change', function() {
            if (catCheck.checked) {
              catSelect.classList.add('d-none');
              catInput.classList.remove('d-none');
              catInput.focus();
            } else {
              catSelect.classList.remove('d-none');
              catInput.classList.add('d-none');
              catInput.value = '';
            }
          });
        }
      });

      // Dropdown dinâmico para categoria de habilidade
      document.addEventListener('DOMContentLoaded', function() {
        var catCheck = document.getElementById('modal-skill-category-new-check');
        var catSelect = document.getElementById('modal-skill-category');
        var catInput = document.getElementById('modal-skill-category-new');
        if (catCheck && catSelect && catInput) {
          catCheck.addEventListener('change', function() {
            if (catCheck.checked) {
              catSelect.classList.add('d-none');
              catInput.classList.remove('d-none');
              catInput.focus();
            } else {
              catSelect.classList.remove('d-none');
              catInput.classList.add('d-none');
              catInput.value = '';
            }
          });
        }
      });

      // Preencher modal ao editar conquista
      window.showAchievementModal = function(achievement) {
        document.getElementById('modal-achievement-id').value = achievement?.id || '';
        document.getElementById('modal-achievement-title').value = achievement?.title || '';
        document.getElementById('modal-achievement-category').value = achievement?.category || '';
        document.getElementById('modal-achievement-desc').value = achievement?.description || '';
        document.getElementById('modal-achievement-status').value = achievement?.status || 'unlocked';
        document.getElementById('modal-achievement-status-switch').checked = achievement?.status !== 'locked';
        document.getElementById('modal-achievement-difficulty').value = achievement?.difficulty || 3;
        const starDiv = document.getElementById('modal-achievement-difficulty-stars');
        if (starDiv) {
          const stars = starDiv.querySelectorAll('i');
          stars.forEach((s, i) => {
            s.className = i < (achievement?.difficulty || 3) ? 'bi bi-star-fill' : 'bi bi-star';
          });
          starDiv.dataset.score = achievement?.difficulty || 3;
        }
        document.getElementById('modal-achievement-unlockedDate').value = achievement?.unlockedDate || '';
        document.getElementById('modal-achievement-evidence').value = achievement?.evidence || '';
        document.getElementById('modal-achievement-img-url').value = achievement?.image || achievement?.img || '';
        const imgPreview = document.getElementById('modal-achievement-img-preview');
        if (imgPreview) {
          imgPreview.src = achievement?.image || achievement?.img || '';
          imgPreview.style.display = (achievement?.image || achievement?.img) ? 'block' : 'none';
        }
        var select = document.getElementById('modal-achievement-relatedSkills');
        if (select && achievement?.relatedSkills) {
          Array.from(select.options).forEach(opt => {
            opt.selected = achievement.relatedSkills.includes(opt.value);
          });
        }
        var achievementModal = new bootstrap.Modal(document.getElementById('achievementModal'));
        achievementModal.show();
      };

      // Preencher modal ao editar habilidade
      window.showSkillModal = async function(skill) {
        if (!window.skillsData || !Array.isArray(window.skillsData.skills)) {
          try {
            const res = await fetch('data/skills.json');
            window.skillsData = await res.json();
          } catch {}
        }
        if (!window.achievements || !Array.isArray(window.achievements)) {
          try {
            const res = await fetch('data/achievements.json');
            window.achievements = await res.json();
          } catch {}
        }
        document.getElementById('modal-skill-id').value = skill?.id || '';
        document.getElementById('modal-skill-name').value = skill?.title || '';
        document.getElementById('modal-skill-icon').value = skill?.icon || '';
        document.getElementById('modal-skill-desc').value = skill?.description || '';
        document.getElementById('modal-skill-unlock-threshold').value = skill?.unlock_threshold || 0;
        var catSelect = document.getElementById('modal-skill-category');
        var catInput = document.getElementById('modal-skill-category-new');
        var catCheck = document.getElementById('modal-skill-category-new-check');
        if (catSelect && catInput && catCheck) {
          if (skill?.category && Array.from(catSelect.options).some(opt => opt.value === skill.category)) {
            catSelect.value = skill.category;
            catSelect.classList.remove('d-none');
            catInput.classList.add('d-none');
            catInput.value = '';
            catCheck.checked = false;
          } else if (skill?.category) {
            catSelect.classList.add('d-none');
            catInput.classList.remove('d-none');
            catInput.value = skill.category;
            catCheck.checked = true;
          } else {
            catSelect.value = 'QA';
            catSelect.classList.remove('d-none');
            catInput.classList.add('d-none');
            catInput.value = '';
            catCheck.checked = false;
          }
        }
        var parentSelect = document.getElementById('modal-skill-parent');
        if (parentSelect && window.skillsData && Array.isArray(window.skillsData.skills)) {
          parentSelect.innerHTML = '<option value="">Nenhuma</option>';
          window.skillsData.skills.forEach(s => {
            if (s.id !== skill?.id) {
              var opt = document.createElement('option');
              opt.value = s.id;
              opt.textContent = s.title + (s.id ? ` (${s.id})` : '');
              parentSelect.appendChild(opt);
            }
          });
          parentSelect.value = skill?.parent || '';
        }
        var childrenSelect = document.getElementById('modal-skill-children');
        if (childrenSelect && window.skillsData && Array.isArray(window.skillsData.skills)) {
          childrenSelect.innerHTML = '';
          window.skillsData.skills.forEach(s => {
            if (s.id !== skill?.id) {
              var opt = document.createElement('option');
              opt.value = s.id;
              opt.textContent = s.title + (s.id ? ` (${s.id})` : '');
              if (Array.isArray(skill?.children) && skill.children.includes(s.id)) opt.selected = true;
              childrenSelect.appendChild(opt);
            }
          });
        }
        var relAchSelect = document.getElementById('modal-skill-relatedAchievements');
        if (relAchSelect && window.achievements && Array.isArray(window.achievements)) {
          relAchSelect.innerHTML = '';
          window.achievements.forEach(a => {
            var opt = document.createElement('option');
            opt.value = a.id;
            opt.textContent = a.title + (a.id ? ` (${a.id})` : '');
            if (Array.isArray(skill?.relatedAchievements) && skill.relatedAchievements.includes(a.id)) opt.selected = true;
            relAchSelect.appendChild(opt);
          });
        }
        const scores = skill?.scores || {};
        const scoreFields = [
          {star: 'modal-score-theoretical-stars', input: 'modal-score-theoretical', val: scores.theoretical ?? 3},
          {star: 'modal-score-technical-stars', input: 'modal-score-technical', val: scores.technical ?? 3},
          {star: 'modal-score-problem-solving-stars', input: 'modal-score-problem-solving', val: scores.problem_solving ?? 3},
          {star: 'modal-score-knowledge-transfer-stars', input: 'modal-score-knowledge-transfer', val: scores.knowledge_transfer ?? 3},
          {star: 'modal-score-trends-stars', input: 'modal-score-trends', val: scores.trends ?? 3}
        ];
        let soma = 0;
        scoreFields.forEach(({star, input, val}) => {
          document.getElementById(input).value = val;
          soma += Number(val) || 0;
          const starDiv = document.getElementById(star);
          if (starDiv) {
            const stars = starDiv.querySelectorAll('i');
            stars.forEach((s, i) => {
              s.className = i < val ? 'bi bi-star-fill' : 'bi bi-star';
            });
            starDiv.dataset.score = val;
          }
        });
        const percent = Math.round((soma / 25) * 100);
        document.getElementById('modal-skill-domain').value = `${soma}/25 (${percent}%)`;
        document.getElementById('modal-domain-value').textContent = `${soma}/25 (${percent}%)`;
        var skillModal = new bootstrap.Modal(document.getElementById('skillModal'));
        skillModal.show();
      };

      // Abrir modal para nova conquista
      document.addEventListener('DOMContentLoaded', function() {
        var btnAddAchievement = document.getElementById('btnAddAchievementModal');
        var achievementModal = new bootstrap.Modal(document.getElementById('achievementModal'));
        if (btnAddAchievement) {
          btnAddAchievement.addEventListener('click', function() {
            document.getElementById('modal-achievement-id').value = '';
            document.getElementById('modal-achievement-title').value = '';
            document.getElementById('modal-achievement-category').value = '';
            document.getElementById('modal-achievement-desc').value = '';
            document.getElementById('modal-achievement-status').value = 'unlocked';
            document.getElementById('modal-achievement-status-switch').checked = true;
            document.getElementById('modal-achievement-difficulty').value = 3;
            const starDiv = document.getElementById('modal-achievement-difficulty-stars');
            if (starDiv) {
              const stars = starDiv.querySelectorAll('i');
              stars.forEach((s, i) => {
                s.className = i < 3 ? 'bi bi-star-fill' : 'bi bi-star';
              });
              starDiv.dataset.score = 3;
            }
            document.getElementById('modal-achievement-unlockedDate').value = '';
            document.getElementById('modal-achievement-evidence').value = '';
            document.getElementById('modal-achievement-img-url').value = '';
            document.getElementById('modal-achievement-img-preview').style.display = 'none';
            var select = document.getElementById('modal-achievement-relatedSkills');
            if (select) Array.from(select.options).forEach(opt => opt.selected = false);
            achievementModal.show();
          });
        }
        var achievementModalForm = document.getElementById('achievement-modal-form');
        if (achievementModalForm) {
          achievementModalForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            var achievement = {
              id: document.getElementById('modal-achievement-id').value || `ach-${Date.now()}`,
              title: document.getElementById('modal-achievement-title').value.trim(),
              category: document.getElementById('modal-achievement-category-new-check').checked
                ? document.getElementById('modal-achievement-category-new').value.trim()
                : document.getElementById('modal-achievement-category').value,
              description: document.getElementById('modal-achievement-desc').value.trim(),
              status: document.getElementById('modal-achievement-status').value,
              difficulty: parseInt(document.getElementById('modal-achievement-difficulty').value) || 3,
              unlockedDate: document.getElementById('modal-achievement-unlockedDate').value,
              evidence: document.getElementById('modal-achievement-evidence').value.trim(),
              relatedSkills: Array.from(document.getElementById('modal-achievement-relatedSkills').selectedOptions).map(opt => opt.value),
              image: document.getElementById('modal-achievement-img-url').value.trim()
            };
            let updated = false;
            if (achievement.id && window.achievements) {
              for (let i = 0; i < window.achievements.length; i++) {
                if (window.achievements[i].id === achievement.id) {
                  window.achievements[i] = achievement;
                  updated = true;
                  break;
                }
              }
            }
            if (!updated) {
              if (!window.achievements) window.achievements = [];
              window.achievements.push(achievement);
            }
            try {
              await window.postJsonApi('achievements', window.achievements);
              renderAchievementsList();
              achievementModal.hide();
              achievementModalForm.reset();
              const toastMsg = document.getElementById('adminToastMsg');
              if (toastMsg) toastMsg.textContent = 'Conquista salva com sucesso!';
              const toast = document.getElementById('adminToast');
              if (toast && window.bootstrap) new bootstrap.Toast(toast).show();
            } catch (e) {
              console.error('Erro ao salvar conquista:', e);
            }
          });
        }
      });

      // Abrir modal para nova habilidade
      document.addEventListener('DOMContentLoaded', function() {
        var btnAddSkill = document.getElementById('btnAddSkillModal');
        var skillModal = new bootstrap.Modal(document.getElementById('skillModal'));
        if (btnAddSkill) {
          btnAddSkill.addEventListener('click', function() {
            document.getElementById('modal-skill-id').value = '';
            document.getElementById('modal-skill-name').value = '';
            document.getElementById('modal-skill-category').value = 'QA';
            document.getElementById('modal-skill-icon').value = '';
            document.getElementById('modal-skill-desc').value = '';
            document.getElementById('modal-skill-unlock-threshold').value = 0;
            document.getElementById('modal-skill-parent').value = '';
            document.getElementById('modal-skill-category-new').value = '';
            document.getElementById('modal-skill-category-new-check').checked = false;
            document.getElementById('modal-skill-category').classList.remove('d-none');
            document.getElementById('modal-skill-category-new').classList.add('d-none');
            var childrenSelect = document.getElementById('modal-skill-children');
            if (childrenSelect) Array.from(childrenSelect.options).forEach(opt => opt.selected = false);
            var relAchSelect = document.getElementById('modal-skill-relatedAchievements');
            if (relAchSelect) Array.from(relAchSelect.options).forEach(opt => opt.selected = false);
            const scoreFields = ['theoretical', 'technical', 'problem-solving', 'knowledge-transfer', 'trends'];
            scoreFields.forEach(field => {
              document.getElementById(`modal-score-${field}`).value = 3;
              const starDiv = document.getElementById(`modal-score-${field}-stars`);
              if (starDiv) {
                const stars = starDiv.querySelectorAll('i');
                stars.forEach((s, i) => {
                  s.className = i < 3 ? 'bi bi-star-fill' : 'bi bi-star';
                });
                starDiv.dataset.score = 3;
              }
            });
            document.getElementById('modal-skill-domain').value = '3/25 (12%)';
            document.getElementById('modal-domain-value').textContent = '3/25 (12%)';
            skillModal.show();
          });
        }
        var skillModalForm = document.getElementById('skill-modal-form');
        if (skillModalForm) {
          skillModalForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            var skill = {
              id: document.getElementById('modal-skill-id').value || `skill-${Date.now()}`,
              title: document.getElementById('modal-skill-name').value.trim(),
              icon: document.getElementById('modal-skill-icon').value.trim(),
              description: document.getElementById('modal-skill-desc').value.trim(),
              unlock_threshold: parseInt(document.getElementById('modal-skill-unlock-threshold').value) || 0,
              category: document.getElementById('modal-skill-category-new-check').checked
                ? document.getElementById('modal-skill-category-new').value.trim()
                : document.getElementById('modal-skill-category').value,
              parent: document.getElementById('modal-skill-parent').value || '',
              children: Array.from(document.getElementById('modal-skill-children').selectedOptions).map(opt => opt.value),
              relatedAchievements: Array.from(document.getElementById('modal-skill-relatedAchievements').selectedOptions).map(opt => opt.value),
              scores: {
                theoretical: parseInt(document.getElementById('modal-score-theoretical').value) || 0,
                technical: parseInt(document.getElementById('modal-score-technical').value) || 0,
                problem_solving: parseInt(document.getElementById('modal-score-problem-solving').value) || 0,
                knowledge_transfer: parseInt(document.getElementById('modal-score-knowledge-transfer').value) || 0,
                trends: parseInt(document.getElementById('modal-score-trends').value) || 0
              },
              ativo: true
            };
            let soma = skill.scores.theoretical + skill.scores.technical + skill.scores.problem_solving + skill.scores.knowledge_transfer + skill.scores.trends;
            let percent = Math.round((soma / 25) * 100);
            skill.domain = `${soma}/25 (${percent}%)`;
            if (!window.skillsData) window.skillsData = { skills: [] };
            let updated = false;
            if (skill.id) {
              for (let i = 0; i < window.skillsData.skills.length; i++) {
                if (window.skillsData.skills[i].id === skill.id) {
                  window.skillsData.skills[i] = skill;
                  updated = true;
                  break;
                }
              }
            }
            if (!updated) {
              window.skillsData.skills.push(skill);
            }
            try {
              await window.postJsonApi('skills', window.skillsData);
              renderSkillsList();
              skillModal.hide();
              skillModalForm.reset();
              document.getElementById('modal-skill-domain').value = '3/25 (12%)';
              document.getElementById('modal-domain-value').textContent = '3/25 (12%)';
              const toastMsg = document.getElementById('adminToastMsg');
              if (toastMsg) toastMsg.textContent = 'Habilidade salva com sucesso!';
              const toast = document.getElementById('adminToast');
              if (toast && window.bootstrap) new bootstrap.Toast(toast).show();
            } catch (e) {
              console.error('Erro ao salvar habilidade:', e);
            }
          });
        }
      });

      // Atualiza domínio ao mudar scores no modal
      document.addEventListener('DOMContentLoaded', function() {
        function updateModalDomain() {
          const t = parseInt(document.getElementById('modal-score-theoretical')?.value) || 0;
          const tec = parseInt(document.getElementById('modal-score-technical')?.value) || 0;
          const ps = parseInt(document.getElementById('modal-score-problem-solving')?.value) || 0;
          const kt = parseInt(document.getElementById('modal-score-knowledge-transfer')?.value) || 0;
          const tr = parseInt(document.getElementById('modal-score-trends')?.value) || 0;
          const total = t + tec + ps + kt + tr;
          const percent = Math.round((total / 25) * 100);
          document.getElementById('modal-domain-value').innerText = `${total}/25 (${percent}%)`;
          document.getElementById('modal-skill-domain').value = `${total}/25 (${percent}%)`;
        }
        ['modal-score-theoretical','modal-score-technical','modal-score-problem-solving','modal-score-knowledge-transfer','modal-score-trends'].forEach(id => {
          const el = document.getElementById(id);
          if (el) {
            el.addEventListener('input', updateModalDomain);
          }
        });
      });

      // Estrelas interativas para pontuações no modal de habilidades
      document.addEventListener('DOMContentLoaded', function() {
        function setupStarRating(starDivId, inputId) {
          var starDiv = document.getElementById(starDivId);
          var input = document.getElementById(inputId);
          if (starDiv && input) {
            const stars = starDiv.querySelectorAll('i');
            stars.forEach((star, idx) => {
              star.addEventListener('click', function() {
                stars.forEach((s, i) => {
                  s.className = i <= idx ? 'bi bi-star-fill' : 'bi bi-star';
                });
                starDiv.dataset.score = idx + 1;
                input.value = idx + 1;
                if (inputId.startsWith('modal-score-')) updateModalDomain();
              });
            });
          }
        }
        setupStarRating('modal-score-theoretical-stars', 'modal-score-theoretical');
        setupStarRating('modal-score-technical-stars', 'modal-score-technical');
        setupStarRating('modal-score-problem-solving-stars', 'modal-score-problem-solving');
        setupStarRating('modal-score-knowledge-transfer-stars', 'modal-score-knowledge-transfer');
        setupStarRating('modal-score-trends-stars', 'modal-score-trends');
      });

      // Microinteração: destaque visual ao selecionar itens no multi-select
      document.addEventListener('DOMContentLoaded', function() {
        function setupMultiSelectHighlight(selectId) {
          var select = document.getElementById(selectId);
          if (!select) return;
          select.addEventListener('change', function() {
            Array.from(select.options).forEach(opt => {
              if (opt.selected) {
                opt.classList.add('selected-option');
              } else {
                opt.classList.remove('selected-option');
              }
            });
          });
          Array.from(select.options).forEach(opt => {
            if (opt.selected) opt.classList.add('selected-option');
          });
        }
        setupMultiSelectHighlight('modal-achievement-relatedSkills');
        setupMultiSelectHighlight('modal-skill-children');
        setupMultiSelectHighlight('modal-skill-relatedAchievements');
      });

      // Foco automático no primeiro campo relevante ao abrir modais
      document.addEventListener('DOMContentLoaded', function() {
        var achievementModal = document.getElementById('achievementModal');
        if (achievementModal) {
          achievementModal.addEventListener('shown.bs.modal', function() {
            var input = document.getElementById('modal-achievement-title');
            if (input) input.focus();
            input && input.classList.add('focus-highlight');
            input && input.addEventListener('blur', function() { input.classList.remove('focus-highlight'); }, {once:true});
          });
        }
        var skillModal = document.getElementById('skillModal');
        if (skillModal) {
          skillModal.addEventListener('shown.bs.modal', function() {
            var input = document.getElementById('modal-skill-name');
            if (input) input.focus();
            input && input.classList.add('focus-highlight');
            input && input.addEventListener('blur', function() { input.classList.remove('focus-highlight'); }, {once:true});
          });
        }
      });

      // Inicializar listagens
      document.addEventListener('DOMContentLoaded', function() {
        renderSkillsList();
        renderAchievementsList();
      });

      // Alternar seções
      function showCrudSection(section) {
        const skillsSection = document.getElementById("skills-section");
        const achievementsSection = document.getElementById("achievements-section");
        const sidebarSkills = document.getElementById("sidebar-skills");
        const sidebarAchievements = document.getElementById("sidebar-achievements");
        if (section === "skills") {
          skillsSection.classList.add("active");
          achievementsSection.classList.remove("active");
          sidebarSkills.classList.add("active");
          sidebarAchievements.classList.remove("active");
        } else {
          skillsSection.classList.remove("active");
          achievementsSection.classList.add("active");
          sidebarSkills.classList.remove("active");
          sidebarAchievements.classList.add("active");
        }
      }
    </script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-ndDqU0Gzau9qJ1lfW4pNLlhNTkCfHzAVBReH9diLvGRem5+R9g2FzA8ZGN954O5Q"
      crossorigin="anonymous"></script>
  </body>
</html>